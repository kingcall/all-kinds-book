### 事实表

- 在ER模型中抽象出了有**实体、关系、属性**三种类别，**在现实世界中，每一个操作型事件，基本都是发生在实体之间的**，伴随着这种操作事件的发生，会产生**可度量的值**，而**这个过程就产生了一个事实表，存储了每一个可度量的事件**
- 可以认为是**主题的各个度量**
  "昨天早上张三在京东花费200元买了一个皮包",这里以购买为主题(过程)的话，200就是针对该过程(主题)的一个度量，所以可以看出事实表示包含了维度表的主键，这个时候就需要通过join 进行关联，**在关联的过程中引入了雪花模型和星型模型以及星座模型**
- **事实表的特点就是增长迅速，且主要以数值进行记录**

#### 事实表的度量

- 可加

> 可以进行任意维度下的累加

- 半可加

> 每个学生的各个科目的成绩是可加的，但是全班的各个科目进行累加是没有意义的

- 不可加
- 需要注意不可加的在任何情况下都是不可加的，比例或者比率是只针对该行有意义，直接累加无意义

#### 一致性

##### 内部一致性

- 在同一个表中，所有记录的粒度和维度是一致的，每一列的单位、枚举值都是一样的

> 想想掌门的学生课程表，少儿和一对一属于两个业务线，放在一起之后字段都无法统一

> 例如 订单表中的金额的单位要进行统一，不能有的是分，有的是元

##### 表与表之间的一致性

- 在进行多表合并的时候要保证彼此之间是针对同一事实的计算，是在同一粒度和维度之下的

> 订单表和退单表进行对冲，我们需要保证维度是一致的，例如可以设置订单表的金额是正的，退单表的金额是负的，然后合并分组求和即可。

#### 事实表设计原则

1. 尽可能包括所有业务过程相关的事实
2. 只选择与业务过程相关的事实
3. 分解不可加事实为可加的组件
4. 选择维度和事实之前必须先声明粒度
5. 在同一个事实表中不可以有多重不同粒度的事实
6. 事实的单位要保持一致
7. 对事实的null值要处理
8. 使用退化维提高事实表的易用性

#### 事实表的分类

##### 事务事实表

- 记录特定事件的事实，如销售。

##### 快照事实表

- 记录给定时间点的事实，如月底账户余额。

##### 累积事实表

- 记录给定时间点的聚合事实，如当月的总的销售金额。一般需要给事实表设计一个代理键作为每行记录的唯一标识。代理键是由系统生成的主键，它不是应用数据，没有业务含义，对用户来说是透明的。
- 累积快照事实表和周期快照事实表有些相似之处，它们存储的都是事务数据的快照信息。但是它们之间也有着很大的不同，周期快照事实表记录的确定的周期的数据，而累积快照事实表记录的不确定的周期的数据。 
- 累积快照事实表代表的是完全覆盖一个事务或产品的生命周期的时间跨度，它通常具有多个日期字段，用来记录整个生命周期中的关键时间点。



### 宽事实表的优缺点

![img](https://kingcall.oss-cn-hangzhou.aliyuncs.com/blog/img/2020/12/08/21:23:19-662342-20190811182341725-1711975459.png)

1、业务直观，在做业务的时候，这种表特别方便，直接能对到业务中。

2、使用方便，写sql的时候很方便。

3、数据冗余巨大，真的很大，在几亿的用户规模下，他的订单行为会很恐怖、粒度僵硬，什么都写死了，这张表的可复用性太低。